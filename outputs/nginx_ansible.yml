---

- hosts: VM1
  gather_facts: false
  vars_files:
    - /Users/hkwany/PycharmProjects/Conductor/vars/nginx.yml
  tasks:
    # service: apt-get update & install essentials for a VM
    - name: apt-get update
      become: yes
      become_user: root
      apt:
        update_cache: yes

    - name: apt install essentials
      become: yes
      become_user: root
      apt:
        name: ""
        state: present
      loop:
        - net-tools
        - nfs-common
        - software-properties-common

    # service: python2, python-dev, pip2 & pip3
    # For Ubuntu, python-dev and python3-dev
    # For CentOS, python-devel and python3-devel
    - name: apt install python2, python-dev, pip2 & pip3
      become: yes
      become_user: root
      apt:
        name: ""
        state: present
      loop:
        - python
        - python-pip
        - python3-pip
        - python-dev

- hosts: VM2
  gather_facts: false
  vars_files:
    - /Users/hkwany/PycharmProjects/Conductor/vars/nginx.yml
  tasks:
    # service: blx
    - name: copy libssl in place if missing
      copy:
        src: services/blx/dependency/libssl1.0.0_1.0.2g-1ubuntu4.16_amd64.deb
        dest: /home/{{ ansible_env.USER }}/libssl1.0.0_1.0.2g-1ubuntu4.16_amd64.deb
        backup: yes

    - name: install libssl.deb
      become: yes
      become_user: root
      apt:
        deb: /home/{{ ansible_env.USER }}/libssl1.0.0_1.0.2g-1ubuntu4.16_amd64.deb

    - name: unarchive blx folders
      become: yes
      become_user: root
      unarchive:
        src: services/blx/blx.tar.gz
        remote_src: no
        copy: yes
        dest: /opt/

 

